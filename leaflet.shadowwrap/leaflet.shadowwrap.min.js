L.ShadowWrap={};L.ShadowWrap.minimumWrapDistance=0;L.ShadowWrap.EventsToShadow=['contextmenu','click','dblclick','mousedown','mouseover','mouseout'];L.ShadowWrap.MethodsToWrap={'L.Layer':{'translated':[['openTooltip',1],['openPopup',1]],'simple':['bindTooltip','unbindTooltip','closeTooltip','toggleTooltip','bindPopup','unbindPopup','closePopup','togglePopup'],},'L.Path':{'simple':['bringToBack','bringToFront','setStyle','redraw','_reset'],},'L.Polyline':{'addInitHook':!0,'shadowCheckType':'cross','simple':['_update'],'multiLatlngs':['_setLatLngs','_convertLatLngs'],'translateRechecked':[['addLatLng',0]],},'L.Polygon':{'shadowCheckType':'cross','multiLatlngs':['_setLatLngs','_convertLatLngs'],},'L.Rectangle':{'shadowCheckType':'cross','special':['_boundsToLatLngs'],},'L.Marker':{'shadowCheckType':'point','simple':['setZIndexOffset','setIcon','_setPos','update','setOpacity'],'translateRechecked':[['setLatLng',0]],},'L.CircleMarker':{'addInitHook':!0,'shadowCheckType':'circle','simple':['setStyle','_updateBounds','_update'],'rechecked':['setRadius'],'translateRechecked':[['setLatLng',0]],},'L.Circle':{'shadowCheckType':'circle','simple':['_project'],'rechecked':['setRadius'],'translateRechecked':[['setLatLng',0]],}};L.ShadowWrap.shadowExceptions={};L.ShadowWrap.addShadowException=function(className,methodName,exception){className=className.replace('L.','');if(!L.ShadowWrap.shadowExceptions[className].hasOwnProperty(methodName)){L.ShadowWrap.shadowExceptions[className][methodName]=[]}
L.ShadowWrap.shadowExceptions[className][methodName].push(exception)};L.ShadowWrap.removeShadowException=function(className,methodName,exceptionToRemove){className=className.replace('L.','');if(!L.ShadowWrap.shadowExceptions[className].hasOwnProperty(methodName)){return}
var cleaned=[];for(var i=0;i<L.ShadowWrap.shadowExceptions[className][methodName].length;i++){var m=L.ShadowWrap.shadowExceptions[className][methodName];if(m!=exceptionToRemove){cleaned.push(m)}}
L.ShadowWrap.shadowExceptions[className][methodName]=cleaned};L.ShadowWrap.checkExceptions=function(className,methodName,obj){if(L.ShadowWrap.shadowExceptions[className].hasOwnProperty(methodName)){var exs=L.ShadowWrap.shadowExceptions[className][methodName];for(var i=0;i<exs.length;i++){if(obj[methodName].caller===exs[i]){return!0}}}
return!1};L.ShadowWrap.initializeShadowHooks=function(){if(this.hasOwnProperty('shadowOptions')){return}
this.shadowOptions={'isShape':!0,'shadowShapes':{},'shadowSplit':!1,'secondaryExecutor':!1};if(this.options.hasOwnProperty('isShadow')&&(this.options.isShadow===!0)){return}
this.shadowOptions.shadowType='normalizeLL';this.shadowOptions.isShadow=!1;this.on('add',this.addShadows,this);this.on('remove',this.removeAllShadows,this)};L.ShadowWrap.installShadowHooks=function(className,classSettings){className=className.replace('L.','');var i;var methodName;var translationIndex;var cls=L[className];L.ShadowWrap.shadowExceptions[className]={};if(classSettings.hasOwnProperty('addInitHook')&&(classSettings.addInitHook===!0)){cls.addInitHook(L.ShadowWrap.initializeShadowHooks)}
if(classSettings.hasOwnProperty('shadowCheckType')){cls.prototype.options.shadowCheckType=classSettings.shadowCheckType}
if(classSettings.hasOwnProperty('simple')){for(i=0;i<classSettings.simple.length;i++){methodName=classSettings.simple[i];L.ShadowWrap.installShadowMethod(cls,className,methodName,null,!1)}}
if(classSettings.hasOwnProperty('rechecked')){for(i=0;i<classSettings.rechecked.length;i++){methodName=classSettings.rechecked[i];L.ShadowWrap.installShadowMethod(cls,className,methodName,null,!0)}}
if(classSettings.hasOwnProperty('translated')){for(i=0;i<classSettings.translated.length;i++){methodName=classSettings.translated[i][0];translationIndex=classSettings.translated[i][1];L.ShadowWrap.installShadowMethod(cls,className,methodName,translationIndex,!1)}}
if(classSettings.hasOwnProperty('translateRechecked')){for(i=0;i<classSettings.translateRechecked.length;i++){methodName=classSettings.translateRechecked[i][0];translationIndex=classSettings.translateRechecked[i][1];L.ShadowWrap.installShadowMethod(cls,className,methodName,translationIndex,!0)}}
if(classSettings.hasOwnProperty('multiLatlngs')){for(i=0;i<classSettings.multiLatlngs.length;i++){methodName=classSettings.multiLatlngs[i];L.ShadowWrap.installInheritedShadowMethod(cls,className,methodName)}}
if(classSettings.hasOwnProperty('special')){for(i=0;i<classSettings.special.length;i++){methodName=classSettings.special[i];cls.prototype[methodName+'__original']=cls.prototype[methodName];cls.prototype[methodName]=L.ShadowWrap.SpecialMethods[methodName]}}};L.ShadowWrap.installShadowMethod=function(cls,className,methodName,translate,recheck){var dispatchedMethodName=methodName+'__original'+className;var isSingle=(cls.prototype.options.shadowCheckType!='cross');cls.prototype[methodName+'__original']=cls.prototype[methodName];cls.prototype[dispatchedMethodName]=cls.prototype[methodName];cls.prototype[methodName]=function(){var args=Array.prototype.slice.call(arguments);var sd=this.shadowDispatchChecks(className,methodName,className,args);if(sd.dispatched){return sd.dispatchResult}
this.shadowOptions.shadowSplit=!0;var ret=this[dispatchedMethodName].apply(this,L.ShadowWrap.translateArgs(this,translate,args));if(recheck){var latlngs=(isSingle)?[this._latlng]:this._latlngs;this.updatingShadowDispatch(dispatchedMethodName,translate!==null,args,latlngs)}
else{this.shadowDispatch(dispatchedMethodName,translate,args)}
this.shadowOptions.shadowSplit=!1;return ret}};L.ShadowWrap.installInheritedShadowMethod=function(cls,className,methodName){var dispatchedMethodName=methodName+'__original'+className;cls.prototype[dispatchedMethodName]=cls.prototype[methodName];cls.prototype[methodName]=function(latlngs){var sd=this.shadowDispatchChecks(className,methodName,className,[latlngs]);if(sd.dispatched){return sd.dispatchResult}
this.shadowOptions.shadowSplit=!0;var llo=this.updatingShadowDispatch(dispatchedMethodName,!0,[],latlngs);var ret=this[dispatchedMethodName](llo.latlngs.normalizeLL);this.shadowOptions.shadowSplit=!1;return ret}};L.ShadowWrap.translateArgs=function(shape,translationIndex,arglist){if(translationIndex===null){return arglist}
var translated=[];for(var i=0;i<arglist.length;i++){if(i===translationIndex){var t=shape[shape.shadowOptions.shadowType](arglist[i]);translated.push(t)}
else{translated.push(arglist[i])}}
return translated};L.ShadowWrap.SpecialMethods={};L.ShadowWrap.SpecialMethods._boundsToLatLngs=function(latLngBounds){if(Array.isArray(latLngBounds)&&(latLngBounds.length>0)){var conv=latLngBounds;if(Array.isArray(latLngBounds[0])&&(latLngBounds[0][0]instanceof L.LatLng)){conv=latLngBounds[0]}
var ll_latLngBounds=[];for(var i=0;i<conv.length;i++){ll_latLngBounds.push(L.latLng(conv[i]))}
latLngBounds=ll_latLngBounds}
return this._boundsToLatLngs__original(latLngBounds)};L.Layer.include({calcShadow:function(latlngs){var result={'needsShadow':{'normLatMirrorLng':!1,'mirrorLatNormLng':!1,'mirrorLL':!1},'latlngs':{'normalizeLL':latlngs,'mirrorLatNormLng':[],'normLatMirrorLng':[],'mirrorLL':[]}};if((!this._map)||(!this.shadowOptions.isShape)){return result}
var i;var shadowType;var flat=!0;if(!(this instanceof L.Marker)&&!(this instanceof L.CircleMarker)){flat=L.LineUtil.isFlat(latlngs)}
result.latlngs.normalizeLL=[];if(flat){for(i=0;i<latlngs.length;i++){for(shadowType in result.latlngs){if(result.latlngs.hasOwnProperty(shadowType)){result.latlngs[shadowType].push(this[shadowType](latlngs[i]))}}}
for(i=0;i<latlngs.length;i++){var j=(i==(latlngs.length-1))?0:(i+1);result.needsShadow.normLatMirrorLng=result.needsShadow.normLatMirrorLng||this.checkWrap('lng',result.latlngs.normalizeLL,i);result.needsShadow.mirrorLatNormLng=result.needsShadow.mirrorLatNormLng||this.checkWrap('lat',result.latlngs.normalizeLL,i)}}
else{for(i=0;i<latlngs.length;i++){var subShadow=this.calcShadow(latlngs[i]);for(shadowType in result.latlngs){if(result.latlngs.hasOwnProperty(shadowType)){result.latlngs[shadowType].push(subShadow.latlngs[shadowType])}}
result.needsShadow.normLatMirrorLng=result.needsShadow.normLatMirrorLng||subShadow.needsShadow.normLatMirrorLng;result.needsShadow.mirrorLatNormLng=result.needsShadow.mirrorLatNormLng||subShadow.needsShadow.mirrorLatNormLng;result.needsShadow.mirrorLL=result.needsShadow.mirrorLL||subShadow.needsShadow.mirrorLL}}
result.needsShadow.mirrorLL=result.needsShadow.normLatMirrorLng&&result.needsShadow.mirrorLatNormLng;return result},checkWrap:function(coord,latlngs,i){var properCoordName=coord.substring(0,1).toUpperCase()+coord.substring(1);if(!this._map.options.crs.hasOwnProperty('wrap'+properCoordName)){return!1}
if(!('shadowCheckType' in this.options)){return!1}
var crossPoints=this._map.options.crs['wrap'+properCoordName];if(this.options.shadowCheckType=='cross'){return this.checkWrapCrossing(coord,crossPoints,latlngs,i)}
else if(this.options.shadowCheckType=='circle'){var radiusLL=this.options.radius;if(this._map.options.crs.hasOwnProperty('R')&&(this._map.options.crs.R!==null)){radiusLL=radiusLL*(180/Math.PI/this._map.options.crs.R)}
return this.checkWrapPoint(coord,crossPoints,latlngs,i,radiusLL)}
else if(this.options.shadowCheckType=='point'){return this.checkWrapPoint(coord,crossPoints,latlngs,i,0)}},checkWrapCrossing:function(coord,crossPoints,latlngs,i){var j=i-1;if(i==0){if(!(this instanceof L.Polygon)){return!1}
j=latlngs.length-1}
var crossA=((latlngs[i][coord]-crossPoints[0])>L.ShadowWrap.minimumWrapDistance)&&((latlngs[j][coord]-crossPoints[0])<=L.ShadowWrap.minimumWrapDistance);var crossB=((latlngs[i][coord]-crossPoints[0])<=L.ShadowWrap.minimumWrapDistance)&&((latlngs[j][coord]-crossPoints[0])>L.ShadowWrap.minimumWrapDistance);var crossC=((latlngs[i][coord]-crossPoints[1])>L.ShadowWrap.minimumWrapDistance)&&((latlngs[j][coord]-crossPoints[1])<=L.ShadowWrap.minimumWrapDistance);var crossD=((latlngs[i][coord]-crossPoints[1])<=L.ShadowWrap.minimumWrapDistance)&&((latlngs[j][coord]-crossPoints[1])>L.ShadowWrap.minimumWrapDistance);if(crossA||crossB||crossC||crossD){return!0}
return!1},checkWrapPoint:function(coord,crossPoints,latlngs,i,LLradius){var crossA=(latlngs[i][coord]-LLradius-crossPoints[0])<=L.ShadowWrap.minimumWrapDistance;var crossB=(latlngs[i][coord]-LLradius-crossPoints[1])<=L.ShadowWrap.minimumWrapDistance;if(crossA||crossB){return!0}
return!1},normLat:function(latlng){if(this._map.options.crs.hasOwnProperty('wrapLat')){var wrapLatMidpoint=(this._map.options.crs.wrapLat[0]+this._map.options.crs.wrapLat[1])/2;if(latlng.lat>wrapLatMidpoint){latlng.lat=latlng.lat-Math.abs(this._map.options.crs.wrapLat[1]-this._map.options.crs.wrapLat[0])}}
return latlng},normLng:function(latlng){if(this._map.options.crs.hasOwnProperty('wrapLng')){var wrapLngMidpoint=(this._map.options.crs.wrapLng[0]+this._map.options.crs.wrapLng[1])/2;if(latlng.lng>wrapLngMidpoint){latlng.lng=latlng.lng-Math.abs(this._map.options.crs.wrapLng[1]-this._map.options.crs.wrapLng[0])}}
return latlng},mirrorLat:function(latlng){if(this._map.options.crs.hasOwnProperty('wrapLat')){var wrapLatMidpoint=(this._map.options.crs.wrapLat[0]+this._map.options.crs.wrapLat[1])/2;if(latlng.lat<=wrapLatMidpoint){latlng.lat=latlng.lat+Math.abs(this._map.options.crs.wrapLat[1]-this._map.options.crs.wrapLat[0])}}
return latlng},mirrorLng:function(latlng){if(this._map.options.crs.hasOwnProperty('wrapLng')){var wrapLngMidpoint=(this._map.options.crs.wrapLng[0]+this._map.options.crs.wrapLng[1])/2;if(latlng.lng<=wrapLngMidpoint){latlng.lng=latlng.lng+Math.abs(this._map.options.crs.wrapLng[1]-this._map.options.crs.wrapLng[0])}}
return latlng},normalizeLL:function(latlng){var ll=this._map.options.crs.wrapLatLng(L.latLng(latlng));this.normLat(ll);this.normLng(ll);return ll},normLatMirrorLng:function(latlng){var ll=this._map.options.crs.wrapLatLng(L.latLng(latlng));this.normLat(ll);this.mirrorLng(ll);return ll},mirrorLatNormLng:function(latlng){var ll=this._map.options.crs.wrapLatLng(L.latLng(latlng));this.mirrorLat(ll);this.normLng(ll);return ll},mirrorLL:function(latlng){var ll=this._map.options.crs.wrapLatLng(L.latLng(latlng));this.mirrorLat(ll);this.mirrorLng(ll);return ll}});L.Layer.include({addShadows:function(){if(this.shadowOptions.isShadow){return}
var isSingle=(this.options.shadowCheckType!='cross');var llo=this.calcShadow((isSingle)?[this._latlng]:this._latlngs);if(isSingle){this._latlng=llo.latlngs.normalizeLL[0]}
else{if(this instanceof L.Polyline){this._setLatLngs__originalPolyline(llo.latlngs.normalizeLL)}
else{this._setLatLngs__originalPolygon(llo.latlngs.normalizeLL)}}
this.changeShadows(llo);this._fixShape()},removeAllShadows:function(){if(this.shadowOptions.isShadow){return}
for(var shadowType in this.shadowOptions.shadowShapes){if(this.shadowOptions.shadowShapes.hasOwnProperty(shadowType)){this._removeShadow(shadowType)}}},changeShadows:function(llo){if(this.shadowOptions.isShadow){return}
var changed={};for(var shadowType in llo.needsShadow){if(llo.needsShadow.hasOwnProperty(shadowType)){var n=llo.needsShadow[shadowType];var o=this.shadowOptions.shadowShapes.hasOwnProperty(shadowType);if(n&&!o){changed[shadowType]=!0;this._addShadow(shadowType,llo.latlngs[shadowType])}
else if(!n&&o){changed[shadowType]=!0;this._removeShadow(shadowType)}}}
return changed},shadowDispatch:function(dispatchedMethodName,translate,args){for(var shadowType in this.shadowOptions.shadowShapes){if(this.shadowOptions.shadowShapes.hasOwnProperty(shadowType)){var shadowShape=this.shadowOptions.shadowShapes[shadowType];shadowShape.shadowOptions.secondaryExecutor=!0;var passedArgs=L.ShadowWrap.translateArgs(shadowShape,translate,args);shadowShape[dispatchedMethodName].apply(shadowShape,passedArgs);shadowShape.shadowOptions.secondaryExecutor=!1}}},updatingShadowDispatch:function(dispatchedMethodName,translate,args,latlngs){var isSingle=(this.options.shadowCheckType!='cross');var llo=this.calcShadow(latlngs);var changed=this.changeShadows(llo);for(var shadowType in this.shadowOptions.shadowShapes){if(this.shadowOptions.shadowShapes.hasOwnProperty(shadowType)){if(changed.hasOwnProperty(shadowType)){continue}
var shadowShape=this.shadowOptions.shadowShapes[shadowType];shadowShape.shadowOptions.secondaryExecutor=!0;if(translate===!0){args=(isSingle)?llo.latlngs[shadowType]:[llo.latlngs[shadowType]]}
shadowShape[dispatchedMethodName].apply(shadowShape,args);shadowShape.shadowOptions.secondaryExecutor=!1}}
return llo},shadowDispatchChecks:function(className,methodName,dispatchTag,args){var dispatchedMethodName=methodName+'__original'+dispatchTag;if((!this._map)||(!this.hasOwnProperty('shadowOptions'))||(!this.shadowOptions.isShape)){return{'dispatched':!0,'dispatchResult':this[dispatchedMethodName].apply(this,args)}}
if(this.shadowOptions.isShadow&&L.ShadowWrap.checkExceptions(className,methodName,this)){return{'dispatched':!0,'dispatchResult':this}}
if(this.shadowOptions.isShadow&&(this.shadowOptions.secondaryExecutor===!1)){this.shadowOptions.secondaryExecutor=!0;var primaryRet=this.shadowOptions.mainShape[methodName].apply(this.shadowOptions.mainShape,args);this.shadowOptions.secondaryExecutor=!1;return{'dispatched':!0,'dispatchResult':primaryRet}}
if(this.shadowOptions.isShadow||this.shadowOptions.shadowSplit){return{'dispatched':!0,'dispatchResult':this[dispatchedMethodName].apply(this,args)}}
return{'dispatched':!1}},_addShadow:function(shadowType,latlngs){var cls=Object.getPrototypeOf(this).constructor;var shadowOpts=L.extend({},this.shadowOptions);delete shadowOpts.nonBubblingEvents;shadowOpts.isShadow=!0;var shadowShape;if(this instanceof L.CircleMarker){shadowShape=new cls(latlngs[0],this.options.radius,shadowOpts)}
else if(this instanceof L.Marker){shadowShape=new cls(latlngs[0],shadowOpts)}
else{shadowShape=new cls(latlngs,shadowOpts)}
this.shadowOptions.shadowShapes[shadowType]=shadowShape;shadowShape.shadowOptions.mainShape=this;shadowShape.shadowOptions.isShadow=!0;shadowShape.shadowOptions.shadowType=shadowType;for(var i=0;i<L.ShadowWrap.EventsToShadow.length;i++){var eventName=L.ShadowWrap.EventsToShadow[i];this._makeShadowEventHandler(shadowType,eventName)}
shadowShape.addTo(this._map);shadowShape._fixShape();this.fire('shadowAdded',{'shadowLayer':shadowShape,'shadowType':shadowType})},_makeShadowEventHandler:function(shadowType,eventName){var that=this;var shadowShape=this.shadowOptions.shadowShapes[shadowType];shadowShape.on(eventName,function(){var args=Array.prototype.slice.call(arguments);args.unshift(eventName);that.fire.apply(that,args)},this)},_fixShape:function(){if('redraw__original' in this){this._reset__original();this.redraw__original()}
else{this.update__original()}},_removeShadow:function(shadowType){if(this.shadowOptions.isShadow){return}
var shadowShape=this.shadowOptions.shadowShapes[shadowType];shadowShape.removeFrom(shadowShape._map);this.fire('shadowRemoved',{'shadowLayer':shadowShape,'shadowType':shadowShape.shadowOptions.shadowType});delete this.shadowOptions.shadowShapes[shadowType]},});L.ShadowWrap.DrawShadowUpdate=function(shape){if(shape.editing._repositionCornerMarkers){shape.editing._repositionCornerMarkers();shape.editing._moveMarker._latlng=shape.getCenter();shape.editing._moveMarker.update();return}
if(shape.editing._getResizeMarkerPoint){shape.editing._moveMarker._latlng=shape.getCenter();shape.editing._moveMarker.update();var resizemarkerPoint=shape.editing._getResizeMarkerPoint(shape._moveMarker._latlng);shape._resizeMarkers[0].setLatLng(resizemarkerPoint);return}
if(shape.editing.updateMarkers){shape.editing.updateMarkers();return}};L.ShadowWrap.DrawShadowHooks=function(){if((!this.editing)||(!this.shadowOptions)){return}
if(this.shadowOptions.isShadow){L.ShadowWrap.DrawShadowUpdate(this.shadowOptions.mainShape);L.ShadowWrap.DrawShadowHooks(this.shadowOptions.mainShape);return}
for(var shadowType in this.shadowOptions.shadowShapes){if(this.shadowOptions.shadowShapes.hasOwnProperty(shadowType)){L.ShadowWrap.DrawShadowUpdate(this.shadowOptions.shadowShapes[shadowType])}}};L.ShadowWrap.initializeDrawShadowHooks=function(){this.on('move',L.ShadowWrap.DrawShadowHooks,this);this.on('resize',L.ShadowWrap.DrawShadowHooks,this);this.on('edit',L.ShadowWrap.DrawShadowHooks,this)};L.ShadowWrap.hookLeafletDraw=function(drawnItems,snapGuideLayers,initialShapeList){var leafletDrawCallback=function(ev){drawnItems.addLayer(ev.layer);if(snapGuideLayers){snapGuideLayers.push(ev.layer)}
if(ev.layer.hasOwnProperty('shadowOptions')){for(var shadowType in ev.layer.shadowOptions.shadowShapes){if(ev.layer.shadowOptions.shadowShapes.hasOwnProperty(shadowType)){var shadowShape=ev.layer.shadowOptions.shadowShapes[shadowType];drawnItems.addLayer(shadowShape);if(snapGuideLayers){snapGuideLayers.push(shadowShape)}}}}
ev.layer.on('shadowAdded',function(e){drawnItems.addLayer(e.shadowLayer);if(snapGuideLayers){snapGuideLayers.push(e.shadowLayer)}});ev.layer.off('shadowRemoved',function(e){drawnItems.removeLayer(e.shadowLayer);if(snapGuideLayers){var slid=L.stamp(e.shadowLayer);for(var i=0;i<snapGuideLayers.length;i++){if(L.stamp(snapGuideLayers[i])==slid){snapGuideLayers.splice(i,1);break}}}})};if((initialShapeList===null)||(typeof(initialShapeList)=='undefined')){initialShapeList=[]}
for(var i=0;i<initialShapeList.length;i++){leafletDrawCallback({'layer':initialShapeList[i]})}
map.on('draw:created',leafletDrawCallback)};L.ShadowWrap.initialize=function(){if(L.Polyline.prototype.hasOwnProperty('setText')){L.ShadowWrap.MethodsToWrap['L.Polyline'].simple.push('setText')}
for(var className in L.ShadowWrap.MethodsToWrap){if(L.ShadowWrap.MethodsToWrap.hasOwnProperty(className)){L.ShadowWrap.installShadowHooks(className,L.ShadowWrap.MethodsToWrap[className])}}
if(L.Control.Draw){L.Marker.addInitHook(L.ShadowWrap.initializeDrawShadowHooks);L.Polyline.addInitHook(L.ShadowWrap.initializeDrawShadowHooks);L.ShadowWrap.addShadowException('Path','setStyle',L.Edit.SimpleShape.prototype.removeHooks);L.ShadowWrap.addShadowException('Path','setStyle',L.Edit.PolyVerticesEdit.prototype.removeHooks)}}